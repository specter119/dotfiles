# Claude Code 配置

## 交流规范

- 用中文交流、写 spec 和文档
- 用英文写代码、注释、日志和 commit message
- 回答简洁，避免冗长解释
- 不明确时主动提问，不臆测

### 回答结构（复杂任务）

1. **直接结论** - 应该怎么做 / 当前最合理的结论
2. **简要推理** - 关键前提、判断步骤、重要权衡
3. **可选方案** - 1-2 个选项及适用场景
4. **下一步计划** - 可执行的行动列表

## 工作流程

### 基础流程

1. **理解需求** - 有疑问立即提问
2. **搜索优先** - 修改前先搜索并阅读相关代码
3. **小步快跑** - 拆分大任务，逐步完成
4. **及时验证** - 每次修改后验证
5. **主动报告** - 完成后报告结果

### 推理框架

操作前完成以下推理：

1. **优先级与约束**：显式规则 > 操作顺序 > 前置条件
2. **风险评估**：低风险直接行动，高风险说明替代方案
3. **复杂度分级**：
   - trivial: 简单语法、<10行修改
   - moderate: 单文件复杂逻辑、局部重构
   - complex: 跨模块设计、大型重构

## 工具使用偏好

### 内置工具（优先使用）

- 搜索内容：`Grep`（不是 bash `rg`）
- 查找文件：`Glob`（不是 bash `fd`）
- 读取文件：`Read`（不是 `cat`）
- 编辑文件：`Edit`（不是 `sed`）
- 创建文件：`Write`（不是 `echo >`）

### 系统工具

- 文本搜索：`rg` > `grep`
- 文件查找：`fd` > `find`
- DNS 查询：`dig` > `nslookup`
- 网络连接：`ss` > `netstat`
- 语法搜索：`ast-grep`

### MCP 工具

| 用途         | 工具                                                                                  |
| ------------ | ------------------------------------------------------------------------------------- |
| 网络搜索     | `mcp__exa__web_search_exa`（每 session 至多尝试一次 WebSearch，失败后持续使用本工具） |
| 网页抓取     | `mcp__exa__crawling_exa`（WebFetch 已禁用，直接使用本工具）                           |
| 代码搜索     | `mcp__exa__get_code_context_exa`                                                      |
| 库文档查询   | `context7 MCP`                                                                        |
| 智能代码搜索 | `mcp__morph-mcp__warpgrep_codebase_search`                                            |
| 高效编辑     | `mcp__morph-mcp__edit_file`                                                           |

<!-- ### Memory 搜索 (claude-mem) -->
<!---->
<!-- **必须主动使用的场景：** -->
<!---->
<!-- 1. 用户暗示历史信息 - "之前说过"、"上次提到"、"你记得吗" -->
<!-- 2. 需要具体值但不确定 - 模型名称、API 配置、参数值（**绝不猜测**） -->
<!-- 3. 涉及用户偏好/约定 - 代码风格、命名规范、工具选择 -->
<!-- 4. 跨 session 任务延续 - 继续之前的工作 -->
<!---->
<!-- ``` -->
<!-- mcp__plugin_claude-mem_mem-search__search(query="...") -->
<!-- mcp__plugin_claude-mem_mem-search__get_recent_context() -->
<!-- ``` -->
<!---->
<!-- **原则：宁可多查一次 memory，也不要猜测。** -->

### 任务管理

- 复杂任务：使用 `Task` 工具启动专门 agent
- 大型重构：使用 `Explore` agent 先理解代码
- 跟踪进度：使用 `TodoWrite` 管理多步骤任务

## 自检与修复

### 回答前自检

1. 任务复杂度：trivial / moderate / complex？
2. 是否在解释已知的基础知识？
3. 是否可以直接修复低级错误？

### 自动修复低级错误

直接修复，无需批准：

- 语法错误（括号不配对、字符串未闭合）
- 明显的缩进或格式问题
- 编译期错误（缺失 import、错误类型）

### 风险操作

破坏性操作（删除文件、重建数据库、`git reset --hard`）必须：

- 明确说明风险
- 给出更安全的替代方案
- 确认用户意图

## 编程原则

遵循软件工程基本原则（DRY, KISS, YAGNI, SRP）。

### 语言特定习惯

#### Python API 设计与代码范式

详见 [Friendly Python](file://$HOME/.config/agents.md.d/friendly_python.md)

#### Python 独立脚本

使用 `uv run` + PEP 723 Inline Script Metadata：

```python
# /// script
# requires-python = ">=3.11"
# dependencies = ["requests", "rich"]
# ///
```

## Git 规范

- Commit message：英文，格式 `<type>: <description>`
- Type：`feat`, `fix`, `refactor`, `docs`, `test`, `chore`
- 每次 commit 逻辑完整
- Push 前确保测试通过

## Skill 设计原则

### 两种内容类型

| 类型                  | 说明                           | 处理方式               |
| --------------------- | ------------------------------ | ---------------------- |
| Claude 不知道的       | 内部流程、API schema、业务规则 | 详细写入 `references/` |
| Claude 已知但需激活的 | 领域理论、设计原则、最佳实践   | 提及权威来源和关键术语 |

### 知识唤醒

| 方法         | ❌ 硬编码规则   | ✅ 知识唤醒                        |
| ------------ | --------------- | ---------------------------------- |
| 提及权威来源 | "代码要整洁"    | "遵循 Robert Martin 的 Clean Code" |
| 使用领域术语 | "函数要短"      | "应用单一职责原则（SRP）"          |
| 说明 WHY     | "每页 5 个要点" | "考虑认知负荷理论（7±2）"          |

### Skill 反馈循环

1. **先诊断 Skill** - 检查是否定义有缺陷
2. **询问用户** - "是否先更新 Skill 再重新生成，还是直接优化当前产出？"
3. **根据选择执行**

**原则**：先治本（Skill），再治标（产出）。
